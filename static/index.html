<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>VLC Kickoff</title>

<script src="bower_components/webcomponentsjs/webcomponents.js"></script>
<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/core-ajax/core-ajax.html">
<link rel="import" href="bower_components/core-selector/core-selector.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/paper-item/paper-item.html">
<link rel="import" href="bower_components/paper-shadow/paper-shadow.html">

<style>
#container {
  max-width: 400px;
}
</style>

</head>

<polymer-element name="streams-ui">
  <template>
    <style>
    paper-shadow {
      margin: 10px;
    }
    paper-item {
      border-bottom: thin solid #cccccc;
    }
    paper-item.core-selected {
      background: #ccffcc;
    }
    </style>

    <core-ajax auto url="streams" handleAs="json" response="{{streams}}"
               on-core-response="{{onStreamsResponse}}">
    </core-ajax>
    <core-ajax id="postStream" url="streams" method="POST"></core-ajax>

    <paper-shadow>
      <core-selector id="streamSelector" selected="{{selectedIndex}}"
                     on-core-select="{{onSelect}}">
        <template repeat="{{streams}}">
          <paper-item noink>{{Name}}</paper-item>
        </template>
      </core-selector>
    </paper-shadow>

    <div horizontal around-justified layout>
      <paper-button raised disabled?="{{selectedIndex == null}}"
                    on-click="{{onWatch}}">
        Watch
      </paper-button>
      <paper-button raised disabled?="{{selectedIndex == null}}"
                    on-click="{{onStop}}">
        Stop
      </paper-button>
    </div>
  </template>
  <script>
    Polymer({
      onStreamsResponse: function(event, detail) {
        for (i in detail.response) {
          var stream = detail.response[i];
          if (stream.Active) {
            this.selectedIndex = i;
          }
        }
      },
      onSelect: function(event, detail) {
        detail.item.templateInstance.model.Active = detail.isSelected;
        this.$.postStream.body = JSON.stringify(
            detail.item.templateInstance.model);
        this.$.postStream.go();
      },
      onWatch: function() {
      },
      onStop: function() {
        this.selectedIndex = null;
      },
    });
  </script>
</polymer-element>

<body unresolved>
<div vertical layout id="container">
  <streams-ui></streams-ui>
</div>
</body>
</html>
